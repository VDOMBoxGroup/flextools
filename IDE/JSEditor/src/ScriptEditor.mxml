<?xml version="1.0" encoding="utf-8"?>
<mx:HTML 
	xmlns:mx="http://www.adobe.com/2006/mxml"
	
	horizontalScrollPolicy="off" verticalScrollPolicy="off"
	
	preinitialize="initalizeHandler()"
	htmlDOMInitialize="completeHandler()">
	<mx:Script>
		<![CDATA[
			private const ID : String = "code_editor";
			private const BASE_URL : String = "app-storage:/edit_area/";
			private var editAreaLoader : *;

			public function get script() : String
			{
				if ( editAreaLoader )
					return editAreaLoader.getValue( ID );
				else
					return null;
			}

			private function load( ... arg ) : void
			{
				editAreaLoader = domWindow.editAreaLoader;
				if ( !editAreaLoader )
					return;
				
				editAreaLoader.init( {
					id: ID, 
					start_highlight: true, 
					font_family: "verdana, monospace", 
					toolbar: "save, |, search, go_to_line, |, undo, redo, |, select_font, |, change_smooth_selection, highlight, |, help", 
					allow_resize: "none", 
					allow_toggle: false, 
					language: "en", 
					save_callback: save_code, 
					syntax: "python" 
				} );
			}
			
			private function save_code( id : String, content : String ) : void
			{
				var d : * = "";
			}
			
			private function getTemplateString() : String
			{
				var template : String = "";
				
				try
				{
					var file : File = new File( BASE_URL + "template.html");
					var fs : FileStream = new FileStream();
					fs.open( file, FileMode.READ );
					template = fs.readUTFBytes( fs.bytesAvailable );
				}
				catch( error : Error ){}
				
				return template;
			}
			
			private function saveCompiledTemplate( path : String, content : String ) : Boolean
			{
				try
				{
					var file : File = new File( path );
					var fs : FileStream = new FileStream();
					fs.open( file, FileMode.WRITE);
					fs.writeUTFBytes( content );
				}
				catch( error : Error )
				{
					return false;
				}
				return true;
			}
			
			private function initalizeHandler() : void
			{
				var file : File  = new File( BASE_URL );
				 
				var fileApp : File = new File("app:/edit_area");
				if( fileApp.exists )
				{
					fileApp.copyTo( file, true );
				}
				
				location= BASE_URL + "init.html"
			}
			
			private function completeHandler() : void
			{	
				domWindow.getTemplateString = getTemplateString;
				domWindow.saveCompiledTemplate = saveCompiledTemplate;
				domWindow.window.onload = load;
			}
		]]>
	</mx:Script>
</mx:HTML>
