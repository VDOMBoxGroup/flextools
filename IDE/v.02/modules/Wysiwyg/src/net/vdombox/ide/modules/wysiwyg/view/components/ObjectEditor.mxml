<?xml version="1.0" encoding="utf-8"?>
<s:SkinnableContainer xmlns:components="net.vdombox.ide.modules.wysiwyg.view.components.*"
					  xmlns:editors="net.vdombox.editors.*"
					  xmlns:fx="http://ns.adobe.com/mxml/2009"
					  xmlns:s="library://ns.adobe.com/flex/spark"
					  skinClass="net.vdombox.ide.modules.wysiwyg.view.skins.ObjectEditorSkin"
					  creationComplete="createionCompleteHandler()"
					  implements="net.vdombox.ide.modules.wysiwyg.interfaces.IEditor">
	<fx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			import mx.events.StateChangeEvent;

			import net.vdombox.ide.common.interfaces.IVDOMObjectVO;
			import net.vdombox.ide.modules.wysiwyg.events.EditorEvent;
			import net.vdombox.ide.modules.wysiwyg.interfaces.IEditor;

			private var _vdomObjectVO : IVDOMObjectVO;

			private var _xml : String;

			public function get vdomObjectVO() : IVDOMObjectVO
			{
				return _vdomObjectVO;
			}

			public function set vdomObjectVO( value : IVDOMObjectVO ) : void
			{
				_vdomObjectVO = value;
			}

			public function get xml() : String
			{
				return xmlScriptEditor ? xmlScriptEditor.scriptAreaComponent.text : _xml;
			}

			public function set xml( value : String ) : void
			{
				_xml = value;

				if ( xmlScriptEditor )
					xmlScriptEditor.scriptAreaComponent.text = value;
			}

			private function addHandlers() : void
			{
				addEventListener( Event.REMOVED_FROM_STAGE, removedFromStageHandler, false, 0, true );

				skin.addEventListener( StateChangeEvent.CURRENT_STATE_CHANGE, changeStateHandler, false, 0, true );
			}

			private function removeHandlers() : void
			{
				removeEventListener( Event.REMOVED_FROM_STAGE, removedFromStageHandler );

				skin.removeEventListener( StateChangeEvent.CURRENT_STATE_CHANGE, changeStateHandler );
			}

			private function dispatchStateEvent() : void
			{
				currentState = skin.currentState;

				if ( skin.currentState.substr( 0, 7 ) == "wysiwyg" )
					dispatchEvent( new EditorEvent( EditorEvent.WYSIWYG_OPENED ) )
				else if ( skin.currentState.substr( 0, 3 ) == "xml" )
					dispatchEvent( new EditorEvent( EditorEvent.XML_EDITOR_OPENED ) )
			}

			private function createionCompleteHandler() : void
			{
				removeEventListener( FlexEvent.CREATION_COMPLETE, createionCompleteHandler );

				addHandlers();

				dispatchEvent( new EditorEvent( EditorEvent.CREATED ) );

				dispatchStateEvent();
			}

			private function removedFromStageHandler( event : Event ) : void
			{
				removeHandlers();
			}

			private function changeStateHandler( event : StateChangeEvent ) : void
			{
				dispatchStateEvent();
			}
		]]>
	</fx:Script>

	<s:states>
		<s:State name="wysiwyg"/>
		<s:State name="wysiwygDisabled"/>
		<s:State name="xml"/>
		<s:State name="xmlDisabled"/>
		<s:State name="normal"/>
		<s:State name="disabled"/>
	</s:states>

	<components:PageRenderer id="renderer"
							 height="100%" width="100%"
							 includeIn="wysiwyg, wysiwygDisabled, normal, disabled"/>

	<editors:XMLScriptEditor id="xmlScriptEditor"
							 height="100%" width="100%"
							 includeIn="xml, xmlDisabled"/>

</s:SkinnableContainer>
