<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml"
				xmlns:s="library://ns.adobe.com/flex/spark"
				xmlns:resourceBrowser="net.vdombox.ide.modules.wysiwyg.view.components.windows.resourceBrouserWindow*"
				
				height="400" width="550"
				backgroundColor="#CCCCCC" paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="5"
				creationComplete="creationCompleteHandler()"
				close="ok_close_window()"
				showCloseButton="true"
				title="Resource Browser">

	<mx:Script>
		<![CDATA[
			import mx.collections.ArrayList;
			import mx.events.FlexEvent;
			
			import net.vdombox.ide.common.vo.ResourceVO;
			import net.vdombox.ide.modules.wysiwyg.ApplicationFacade;
			import net.vdombox.ide.modules.wysiwyg.events.ResourceSelectorWindowEvent;

			[ Bindable ]
			private var totalResources : int = 0;
			
			[ Bindable ]
			private var filteredResources : int = 0;
			
			[Bindable]
			private var _resources : ArrayList;

			private var _value : String;

			public function get value() : String
			{
				return resourcesList.selectedItem ? resourcesList.selectedItem.id : "";
			}

			public function set value( value : String ) : void
			{
				_value = value;
				setSelectedItem();
			}

			public function set resources( value : Array ) : void
			{
				_resources = new ArrayList( value );
				setSelectedItem();
			}

			private function setSelectedItem() : void
			{
				if ( !_resources || _resources.length == 0 )
					return;

				var resourceVO : ResourceVO;

				for each ( resourceVO in _resources.source )
				{
					if ( resourceVO.id == _value.substring( 5, _value.length - 1 ) )
					{
						resourcesList.selectedItem = resourceVO;
						break;
					}
				}
			}
			
			/**
			 * @private
			 * close ResourceSelectorWindow if down ESCAPE or if down button "Apply"
			 * and dispatchEvent Apply
			 */ 
			private function ok_close_window( event: KeyboardEvent = null ) : void
			{
				if ( event != null )
					if ( event.charCode != Keyboard.ESCAPE )
						return
						
				dispatchEvent( new ResourceSelectorWindowEvent( ResourceSelectorWindowEvent.CLOSE ))
			}		

			private function creationCompleteHandler() : void
			{
				this.setFocus();
//				dispatchEvent( FlexEvent.CREATION_COMPLETE );
				addEventListener( KeyboardEvent.KEY_DOWN, ok_close_window );					
			}
			
			protected function uploadFile(event:MouseEvent):void
			{
				dispatchEvent( new ResourceSelectorWindowEvent( ResourceSelectorWindowEvent.LOAD_RESOURCE));			
			}
			
			protected function refreshFile(event:MouseEvent):void
			{
				dispatchEvent( new ResourceSelectorWindowEvent( ResourceSelectorWindowEvent.GET_RESOURCES));			
			}

// todo delete
			/*private var fileRef:FileReference = new FileReference();
			
			protected function uploadFile(event:MouseEvent):void
			{
				fileRef.addEventListener(Event.SELECT, fileSelected);				
				fileRef.browse();				
			}
			
			protected function fileSelected(event:Event):void
			{
				fileRef.addEventListener(Event.COMPLETE, fileDounloaded);
				fileRef.load();				
			}			
			
			protected function fileDounloaded(event:Event):void
			{
				var resData : ByteArray = fileRef.data;
				resData.compress();
				
				var base64Data : Base64Encoder = new Base64Encoder();
				base64Data.insertNewLines = false;
				base64Data.encodeBytes( resData );					
									
				var obj:Object = new Object;
				obj = {"name":fileRef.name, "type":fileRef.type, "data":base64Data.toString() };
				
				dispatchEvent( new ResourceSelectorWindowEvent( ResourceSelectorWindowEvent.LOAD_RESOURCE));
			}*/

		]]>
	</mx:Script>

	<!-- header -->
	<mx:HBox width="100%"
			 backgroundColor="#C2C2C2" borderColor="#000000" bottom="0" horizontalGap="0" paddingLeft="5"
			 paddingRight="5" verticalAlign="middle">
		
		<mx:Label text="Filter: "/>
		
		<mx:ComboBox id="filter"/>
		
		<mx:Spacer width="100%"/>
		
		<mx:Button label="Refresh"
				   cornerRadius="0"
				   click="refreshFile(event)" />
		
		<mx:Button label="Upload File..."
				   cornerRadius="0"
				   click="uploadFile(event)" />	
	</mx:HBox>
		
	
	<!-- body -->
	<!--s:List id="resourcesList"
			dataProvider="{ _resources }" height="100%" width="100%"
			itemRenderer="net.vdombox.ide.modules.wysiwyg.view.components.ResourceItemRenderer"
			useVirtualLayout="false" /-->
	<mx:VBox height="100%" width="207"
			 paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0" verticalGap="0">
		
		<mx:HBox width="100%"
				 horizontalGap="3" paddingBottom="3" paddingLeft="5" paddingRight="0" paddingTop="3" verticalAlign="middle">
			
			<mx:TextInput id="__nameFilter"
						  text="type a filter here" width="100%"
						  borderColor="#999999" borderStyle="solid" color="#666666"
						  fontFamily="Tahoma" fontWeight="bold"/>
			
			<mx:Image id="__spinner"
					  height="18"  width="18" visible="false"/>
		</mx:HBox>
		
		<mx:List id="resourcesList" dataProvider="{ _resources }"
				 height="100%" horizontalScrollPolicy="off" verticalScrollPolicy="on" width="100%"
				 borderStyle="solid" paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="5"
				 itemRenderer="net.vdombox.ide.modules.wysiwyg.view.components.windows.resourceBrowserWindow.ListItem"/>
	</mx:VBox>

	
	<!--  temp  -->
	<mx:HBox width="100%"
			 backgroundColor="#C2C2C2" borderColor="#000000" bottom="0" horizontalGap="0" paddingLeft="5"
			 paddingRight="5" verticalAlign="middle">

		<mx:Spacer width="100%" />

		<mx:Button label="Apply"
				   cornerRadius="0"
				   click="dispatchEvent( new ResourceSelectorWindowEvent( ResourceSelectorWindowEvent.APPLY ))" />
	</mx:HBox>
	
	
	<!--  futer  -->
	<mx:HBox height="30" width="100%"
			 backgroundColor="#858585" color="#FFFFFF" paddingBottom="2" paddingLeft="10" paddingRight="10"
			 paddingTop="2" verticalAlign="middle">
		
		<mx:Label text="Total Resources:"/>
		
		<mx:Label text="{totalResources}"
				  fontWeight="bold"/>
		
		<mx:VRule height="18"/>
		
		<mx:Label text="Filtered:"/>
		
		<mx:Label text="{filteredResources}"
				  fontWeight="bold"/>
		<mx:VRule height="18"/>
		
		<mx:Spacer width="100%"/>
		
		<mx:Button label="Done" />
		
	</mx:HBox>
	
	
</mx:TitleWindow>
