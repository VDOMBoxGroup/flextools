<?xml version="1.0" encoding="utf-8"?>
<s:Group 
	xmlns:fx="http://ns.adobe.com/mxml/2009" 
	xmlns:s="library://ns.adobe.com/flex/spark" 
	xmlns:mx="library://ns.adobe.com/flex/halo"
	
	doubleClickEnabled="true" height="30" minWidth="300"
	
	creationComplete="creationCompleteHandler()">
	<fx:Metadata>
		[Event(name="logout", type="flash.events.Event")]
	</fx:Metadata>
	<fx:Script>
		<![CDATA[
			import mx.core.FlexGlobals;
			import mx.core.Window;
			import mx.managers.SystemManager;
			import mx.core.windowClasses.TitleBar;
			import mx.core.WindowedApplication;
			import mx.core.Application;
			import mx.core.IWindow;

			private function creationCompleteHandler() : void
			{
				addEventListener( MouseEvent.MOUSE_DOWN, mouseDownHandler );
				addEventListener( MouseEvent.DOUBLE_CLICK, doubleClickHandler );

				minimizeButton.setStyle( "skin", getStyle( "minimizeButton" ) );
				minimizeButton.focusEnabled = false;
				minimizeButton.enabled = window.minimizable;
				minimizeButton.addEventListener( MouseEvent.MOUSE_DOWN, button_mouseDownHandler );
				minimizeButton.addEventListener( MouseEvent.CLICK, minimizeButton_clickHandler );


				maximizeButton.setStyle( "skin", getStyle( "maximizeButton" ) );
				maximizeButton.focusEnabled = false;
				maximizeButton.enabled = window.maximizable;
				maximizeButton.addEventListener( MouseEvent.MOUSE_DOWN, button_mouseDownHandler );
				maximizeButton.addEventListener( MouseEvent.CLICK, maximizeButton_clickHandler );


				closeButton.setStyle( "skin", getStyle( "closeButton" ) );
				closeButton.focusEnabled = false;
				closeButton.addEventListener( MouseEvent.MOUSE_DOWN, button_mouseDownHandler );
				closeButton.addEventListener( MouseEvent.CLICK, closeButton_clickHandler );
			}

			private function get window() : IWindow
			{
				return IWindow( Window.getWindow( this ) );
			}

			private static function isMac() : Boolean
			{
				return Capabilities.os.substring( 0, 3 ) == "Mac";
			}

			override protected function updateDisplayList( unscaledWidth : Number,
														   unscaledHeight : Number ) : void
			{
				super.updateDisplayList( unscaledWidth, unscaledHeight );

				if ( window.nativeWindow.closed )
					return;

				if ( !isMac() )
				{

					if ( window.nativeWindow.displayState == NativeWindowDisplayState.MAXIMIZED )
					{

						if ( getStyle( "restoreButton" ) )
							maximizeButton.setStyle( "skin", getStyle( "restoreButton" ) );

					}
					else
						maximizeButton.setStyle( "skin", getStyle( "maximizeButton" ) );
				}
			}

			private function minimizeButton_clickHandler( event : Event ) : void
			{
				window.minimize();
			}

			private function maximizeButton_clickHandler( event : Event ) : void
			{
				if ( window.nativeWindow.displayState == NativeWindowDisplayState.MAXIMIZED )
					window.restore();

				else
				{
					window.maximize();
					// work around bug  Bug SDK-9547
					maximizeButton.dispatchEvent( new MouseEvent( MouseEvent.ROLL_OUT ) );
				}
			}

			private function closeButton_clickHandler( event : Event ) : void
			{
				FlexGlobals.topLevelApplication.exit();
			}

			private function mouseDownHandler( event : MouseEvent ) : void
			{
				/* if( event.target == logoffButton )
				 return; */
				window.nativeWindow.startMove();

				event.stopPropagation();
			}

			private function doubleClickHandler( event : MouseEvent ) : void
			{
				if ( isMac() )
					window.minimize();

				else
				{

					if ( window.nativeWindow.displayState == NativeWindowDisplayState.MAXIMIZED )

						window.restore();

					else
						window.maximize();

				}
			}

			private function button_mouseDownHandler( event : MouseEvent ) : void
			{

				event.stopPropagation();
			}

			private function logout() : void
			{
//				dataManager.close();
				dispatchEvent( new Event( "logout" ) );
			}
		]]>
	</fx:Script>
	<mx:Button 
		id="minimizeButton"
		
		height="13" width="13"
		
		right="41" top="5"/>
	<mx:Button 
		id="maximizeButton"
		
		height="13" width="13"
		
		right="23" top="5"/>
	<mx:Button 
		id="closeButton"
		
		height="13" width="13"
		
		right="5" top="5"/>
	<mx:Button 
		height="16" visible="false" width="24" y="1"
		
		cornerRadius="0" fillAlphas="[1.0, 1.0]" fillColors="[#FF0000, #FF0000]"
		right="69"/>
	<mx:Label 
		text="Vdom IDE User: " y="5"
		
		color="#969696" fontSize="14" fontWeight="bold" horizontalCenter="0"/>
	<!--<mx:LinkButton id="logoffButton" label="{ resourceManager.getString( 'Application','logout' ) }"
		 color="#FFFFFF" fontWeight="bold" right="10" rollOverColor="#333333" selectionColor="#333333"
		 textRollOverColor="#FFFFFF" textSelectedColor="#FFFFFF" top="24"
		 click="logout();"/>-->
</s:Group>
