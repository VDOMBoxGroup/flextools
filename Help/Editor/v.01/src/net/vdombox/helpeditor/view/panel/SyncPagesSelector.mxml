<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml">
	
	<mx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			import mx.events.ListEvent;
			import mx.events.TreeEvent;
			
			import net.vdombox.helpeditor.controller.events.PagesSyncronizationEvent;
			import net.vdombox.helpeditor.model.SQLProxy;
			import net.vdombox.helpeditor.view.itemrenderers.TreeItemRenderer;
			
			public var syncGroupName : String;
			
			private var sqlProxy : SQLProxy = new SQLProxy();
			
			private var products : Object = sqlProxy.getAllProducts();
			
			public function get pages () : XMLList
			{
				var xmlList : XMLList = new XMLList();
				
				if (!products)
					return null;
				
				for each (var product : Object in products)
				{
					var xmlProductPages : XML = product.toc;
					
					xmlList += xmlProductPages;
				}
				
				return xmlList;
			}
			
			public function updatePages () : void
			{
				pagesTree.dataProvider = null;
				pagesTree.dataProvider = pages;
			}
			
			protected function pagesTree_creationCompleteHandler(event:FlexEvent):void
			{
				pagesTree.addEventListener(PagesSyncronizationEvent.SELECTION_CHANGED, this.dispatchEvent, true);
			}
			
			private function treeItemRenderer_getCurrentSyncGroupNameHandler (event : PagesSyncronizationEvent) : void
			{
				var selectedTreeItemRenderer : TreeItemRenderer = event.target as TreeItemRenderer;
				
				selectedTreeItemRenderer.currentSyncGroupName = syncGroupName;
			}
			
			protected function pagesTree_initializeHandler(event:FlexEvent):void
			{
				pagesTree.addEventListener(PagesSyncronizationEvent.GET_CUR_SYNC_GROUP_NAME, treeItemRenderer_getCurrentSyncGroupNameHandler, true);
			}
			
		]]>
	</mx:Script>
	
	<mx:Tree id="pagesTree"
			 width="100%" height="100%"
			 itemRenderer="net.vdombox.helpeditor.view.itemrenderers.TreeItemRenderer"
			 labelField="@title"
			 defaultLeafIcon="{null}"
			 folderClosedIcon="{null}"
			 folderOpenIcon="{null}"
			 creationComplete="pagesTree_creationCompleteHandler(event)"
			 initialize="pagesTree_initializeHandler(event)"/>
	
</mx:VBox>
