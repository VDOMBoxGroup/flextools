<?xml version="1.0" encoding="utf-8"?>
<ModalDialog 
	xmlns="PowerPack.com.dialog.*" 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	width="500" height="360"
	title="{LanguageManager.sentences.properties}" 
	modal="false"
	alwaysInFront="true"
	creationComplete="onShow(event)" 
	xmlns:controls="ExtendedAPI.com.controls.*">
	
	<mx:Script>
		<![CDATA[
			import mx.events.CloseEvent;
			import mx.utils.StringUtil;
			import PowerPack.com.managers.ContextManager;
			import PowerPack.com.managers.LanguageManager;
			
			private static var _dialog:TemplateProperties;
			
			static public function show(closeHandler:Function = null):TemplateProperties
			{
				if(!_dialog || _dialog.closed) 
				{
					_dialog = new TemplateProperties();	
					_dialog.open();
					_dialog.addEventListener(CloseEvent.CLOSE, _dialog.onClose);
					_dialog.show(OK | CANCEL, closeHandler, null, OK);		
					
					var defaultCaptions:Object = {
						template_properties: "Template properties",
						template_name: "Template name",
						template_description: "Description",
						template_picture: "Template picture",
						template_remove_pic: "Remove picture",			
						template_key: "Template key"	
					};
					
					LanguageManager.setSentences(defaultCaptions);	
				}				
				else 
				{
					_dialog.activate();
				}
				
				return _dialog;
			}
			
			private function onShow(event:Event):void
			{
				if(ContextManager.instance.templates.getItemAt(0).picture)
				{
					gridRemovePic.visible = true;
					gridRemovePic.includeInLayout = true;
				}
				else
				{
					gridRemovePic.visible = false;
					gridRemovePic.includeInLayout = false;
				}	
				
				txtName.setFocus();			
			}
			
			private function onClose(event:Event):void
			{
				if(event is CloseEvent && CloseEvent(event).detail == ModalDialog.OK)
            	{
            		ContextManager.instance.templates.getItemAt(0).name = txtName.text;
					ContextManager.instance.templates.getItemAt(0).description = txtDesc.text;
					ContextManager.instance.templates.getItemAt(0).picturePath = StringUtil.trim(picBrowse.text);
					ContextManager.instance.templates.getItemAt(0).key = StringUtil.trim(txtKey.text);
            	}
            }
            			
			private function removePicture():void
			{
				gridRemovePic.visible = false;
				gridRemovePic.includeInLayout = false;
					
				picBrowse.txtInput.text = '';
				picBrowse.text = '';
				ContextManager.instance.templates.getItemAt(0).picturePath = '';
				
				delete ContextManager.instance.templates.getItemAt(0).xml.picture;
			}
				
		]]>
	</mx:Script>
	<mx:VBox styleName="dlgHeader" width="100%">
		<mx:Label text="{LanguageManager.sentences.template_properties}" styleName="headerLabel"/>
	</mx:VBox>
	
	<mx:HRule width="100%"/>
		
	<mx:VBox styleName="dlgContent" height="100%">
		<mx:Grid>
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_name}:"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<mx:TextInput width="300" id="txtName" 
						text="{ContextManager.instance.templates.getItemAt(0).name}"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_description}:"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<mx:TextArea width="300" height="90" id="txtDesc" 
						text="{ContextManager.instance.templates.getItemAt(0).description}"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%" colSpan="2">
					<controls:HDivider label="{LanguageManager.sentences.template_picture}"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_picture}:"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<controls:FileBrowseBox id="picBrowse" width="300" mode="open" 
						browseLabel="{LanguageManager.sentences.browse}..." 
						browseTitle="{LanguageManager.sentences.open_file}..."
						filterAll="{LanguageManager.sentences.all}"
						text="{ContextManager.instance.templates.getItemAt(0).picturePath}"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%" id="gridRemovePic" visible="false" includeInLayout="false">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_remove_pic}:"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">					
					<mx:Button id="btnRemovePic" label="{LanguageManager.sentences.remove}" 
						click="removePicture()"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%" colSpan="2">
					<mx:HRule width="100%"/>
				</mx:GridItem>
			</mx:GridRow>
									
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_key}:"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<mx:TextInput id="txtKey" 
						text="{ContextManager.instance.templates.getItemAt(0).key}" width="300"/>
				</mx:GridItem>
			</mx:GridRow>
		</mx:Grid>
	</mx:VBox>

	<mx:HRule width="100%"/>
	
	<mx:ControlBar width="100%" styleName="dlgFooter">
	</mx:ControlBar>
	
</ModalDialog>
