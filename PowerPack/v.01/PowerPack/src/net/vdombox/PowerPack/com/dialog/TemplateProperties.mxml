<?xml version="1.0" encoding="utf-8"?>
<ModalDialog 
	xmlns="net.vdombox.PowerPack.com.dialog.*" 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	width="500" height="460"
	title="{LanguageManager.sentences.properties}" 
	creationComplete="onShow(event)" 
	xmlns:controls="ExtendedAPI.com.controls.*">
	
	<mx:Script>
		<![CDATA[
			import net.vdombox.PowerPack.com.Template;
			import mx.events.CloseEvent;
			import mx.utils.StringUtil;
			import net.vdombox.PowerPack.com.managers.ContextManager;
			import net.vdombox.PowerPack.com.managers.LanguageManager;
			
			private static var _dialog:TemplateProperties;
			
			static public function show(closeHandler:Function = null):TemplateProperties
			{
				if(!_dialog || _dialog.closed) 
				{
					_dialog = new TemplateProperties();	
					_dialog.open();
					_dialog.show(OK | CANCEL, closeHandler, null, OK);
					
					var defaultCaptions:Object = {
						template_properties: "Template properties",
						template_name: "Template name",
						template_description: "Description",
						template_picture: "Template picture",
						template_remove_pic: "Remove picture",
						template_key: "Template key"
					};
					
					LanguageManager.setSentences(defaultCaptions);
				}				
				else 
				{
					_dialog.activate();
				}
				
				return _dialog;
			}
			
			private function onShow(event:Event):void
			{            	
            	var tpl:Template = ContextManager.templates.getItemAt(0) as Template; 
				
				if(tpl.b64picture || tpl.picture)
				{
					gridRemovePic.visible = true;
					gridRemovePic.includeInLayout = true;
				}
				else
				{
					gridRemovePic.visible = false;
					gridRemovePic.includeInLayout = false;
				}				
            		
        		txtName.text = tpl.name;
				txtDesc.text = tpl.description;
				if(tpl.picture)
					picBrowse.text = tpl.picture.nativePath;
				txtKey.text = tpl.key;
				
				if(tpl.picture)
				{
					tplImg.source = tpl.picture.nativePath; 

					b64Img.visible = false; 
					b64Img.includeInLayout = false; 

					tplImg.visible = true; 
					tplImg.includeInLayout = true; 
				} 
				else if(tpl.b64picture)
				{
					b64Img.source = tpl.b64picture;

					tplImg.visible = false; 
					tplImg.includeInLayout = false; 

					b64Img.visible = true; 
					b64Img.includeInLayout = true; 
				}
				else
				{
					b64Img.visible = tplImg.visible = false; 
					b64Img.includeInLayout = tplImg.includeInLayout = false; 
				}

				txtName.setFocus();			
			}
			
			private function removePicture():void
			{
				var tpl:Template = ContextManager.templates.getItemAt(0) as Template;
				
				gridRemovePic.visible = false;
				gridRemovePic.includeInLayout = false;
					
				picBrowse.txtInput.text = '';
				picBrowse.text = '';
				tpl.picture = null;
				
				delete tpl.xml.picture;
			}
				
		]]>
	</mx:Script>
	<mx:VBox styleName="dlgHeader" width="100%">
		<mx:Label text="{LanguageManager.sentences.template_properties}" styleName="headerLabel"/>
	</mx:VBox>
	
	<mx:HRule width="100%"/>
		
	<mx:VBox styleName="dlgContent" height="100%">
		<mx:Grid>
		
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_name}:"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<mx:TextInput width="300" id="txtName"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_description}:"/>					
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<mx:TextArea width="300" height="90" id="txtDesc"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%" colSpan="2">
					<controls:HDivider label="{LanguageManager.sentences.template_picture}"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_picture}:"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<controls:FileBrowseBox id="picBrowse" width="300" mode="open" 
						browseLabel="{LanguageManager.sentences.browse}..." 
						browseTitle="{LanguageManager.sentences.open_file}..."
						filterAll="{LanguageManager.sentences.all}"
						text=""/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%" id="gridRemovePic">
				<mx:GridItem width="100%" height="100%">
					<!--mx:Label text="{LanguageManager.sentences.template_remove_pic}:"/-->
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">					
					<mx:Image width="100" height="100" scaleContent="true" autoLoad="true" id="tplImg"/>
					<controls:Base64Image width="100" height="100" scaleContent="true" autoLoad="true" id="b64Img"/>
					<mx:Button id="btnRemovePic" label="{LanguageManager.sentences.remove}" 
						click="removePicture()"/>
				</mx:GridItem>
			</mx:GridRow>
			
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%" colSpan="2">
					<mx:HRule width="100%"/>
				</mx:GridItem>
			</mx:GridRow>
									
			<mx:GridRow width="100%" height="100%">
				<mx:GridItem width="100%" height="100%">
					<mx:Label text="{LanguageManager.sentences.template_key}:"/>
				</mx:GridItem>
				<mx:GridItem width="100%" height="100%">
					<mx:TextInput id="txtKey" width="300"/>
				</mx:GridItem>
			</mx:GridRow>
			
		</mx:Grid>
	</mx:VBox>

	<mx:HRule width="100%"/>
	
	<mx:ControlBar width="100%" styleName="dlgFooter">
	</mx:ControlBar>
	
</ModalDialog>
