<?xml version="1.0" encoding="utf-8"?>
<mx:ControlBar xmlns:mx="http://www.adobe.com/2006/mxml" 
			   horizontalGap="3" verticalAlign="middle" 
			   height="35">
	<mx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			
			import net.vdombox.powerpack.dialog.ProjectsSettingsDialog;
			import net.vdombox.powerpack.lib.player.managers.ContextManager;
			import net.vdombox.powerpack.lib.player.template.Template;
			import net.vdombox.powerpack.lib.player.template.TemplateProject;
			import net.vdombox.powerpack.panel.Graphs;
			import net.vdombox.powerpack.template.BuilderTemplate;
			import net.vdombox.powerpack.template.BuilderTemplateProject;
			
			static public const TPL_CHANGED : String = "templateChanged";
			
			private function cbInitGraphChangeHandler( event : Event ) : void
			{
				currentTemplate.selectedProject = appsComboBox.selectedItem as TemplateProject;
				
				appsComboBox.selectedItem = currentTemplate.selectedProject;
				
				dispatchEvent( new Event( TPL_CHANGED ) );
			}
			
			private function get currentTemplate() : BuilderTemplate
			{
				if ( !ContextManager.templates || ContextManager.templates.length == 0 )
					return null;
				
				return ContextManager.templates.getItemAt( 0 ) as BuilderTemplate;
			}
			
			protected function appSettings_clickHandler(event:MouseEvent):void
			{
				ProjectsSettingsDialog.show(Graphs.graphs);
			}
			
		]]>
	</mx:Script>
	
	<mx:Label text="Applications:" />
	
	<mx:ComboBox id="appsComboBox"
				 width="200"
				 dataProvider="{ContextManager.templates.getItemAt( 0 ).projects}" 
				 labelField="name"
				 selectedIndex="{ContextManager.templates.getItemAt( 0 ).selectedProjectIndex}"
				 change="cbInitGraphChangeHandler(event)"/>
	
	<mx:Image source="@Embed('assets/icons/settings.png')" 
			  toolTip="Application settings"
			  click="appSettings_clickHandler(event)"/>
	
	<mx:VRule height="20"/>
	
	<mx:Button label="Build "/>
</mx:ControlBar>
