<?xml version="1.0" encoding="utf-8"?>
<mx:ControlBar xmlns:mx="http://www.adobe.com/2006/mxml" 
			   horizontalGap="7" verticalAlign="middle" 
			   height="35"
			   creationComplete="creationCompleteHandler(event)" xmlns:control="net.vdombox.powerpack.lib.player.control.*">
	<mx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			
			import net.vdombox.powerpack.dialog.AirBuildProperties;
			import net.vdombox.powerpack.dialog.ProjectsSettingsDialog;
			import net.vdombox.powerpack.lib.extendedapi.utils.FileUtils;
			import net.vdombox.powerpack.lib.player.managers.ContextManager;
			import net.vdombox.powerpack.lib.player.template.Template;
			import net.vdombox.powerpack.lib.player.template.TemplateProject;
			import net.vdombox.powerpack.menu.MenuGeneralEvent;
			import net.vdombox.powerpack.menu.MenuManager;
			import net.vdombox.powerpack.panel.Graphs;
			import net.vdombox.powerpack.template.BuilderTemplate;
			import net.vdombox.powerpack.template.BuilderTemplateProject;
			
			public static const ITEM_TYPE_APP_PROPERIES		: String = "properties";
			public static const ITEM_TYPE_BUILD_INSTALLER	: String = "air_builder";
			
			public static const ITEM_TYPE_RUN				: String = "run";
			public static const ITEM_TYPE_DEBUG				: String = "debug";
			public static const ITEM_TYPE_STEP_BY_STEP		: String = "step_by_step";
			
			public static const ITEM_TYPE_STEP_INTO			: String = "step_into";
			public static const ITEM_TYPE_STEP_OVER			: String = "step_over";
			public static const ITEM_TYPE_STEP_RETURN		: String = "step_return";
			public static const ITEM_TYPE_RESUME			: String = "resume";
			public static const ITEM_TYPE_BREAK				: String = "break";
			
			private function cbApplicationsChangeHandler( event : Event ) : void
			{
				currentTemplate.selectedProject = appsComboBox.selectedItem as TemplateProject;
				
				appsComboBox.selectedItem = currentTemplate.selectedProject;
			}
			
			private function get currentTemplate() : BuilderTemplate
			{
				if ( !ContextManager.templates || ContextManager.templates.length == 0 )
					return null;
				
				return ContextManager.templates.getItemAt( 0 ) as BuilderTemplate;
			}
			
			protected function menuItem_clickHandler(event:MouseEvent, itemType : String):void
			{
				var evt : ControlBarEvent = new ControlBarEvent(ControlBarEvent.EVENT_ITEM_CLICK);
				evt.targetItemType = itemType;
				
				dispatchEvent(evt);
			}
			
			public function menuRunStateChangedHandler (event : MenuGeneralEvent) : void
			{
				if (!MenuManager.getInstance().menu)
					return;
				
				var runMenuItem : NativeMenuItem = MenuManager.getInstance().menu.nativeMenu.getItemByName( MenuManager.MENU_RUN );
				
				menuBtnRun.enabled = runMenuItem.submenu.getItemByName( "run" ).enabled;
				menuBtnStepByStep.enabled = runMenuItem.submenu.getItemByName( "step_by_step" ).enabled;
				menuBtnDebug.enabled = runMenuItem.submenu.getItemByName( "debug" ).enabled;
				
				menuBtnBreak.enabled = runMenuItem.submenu.getItemByName( "break" ).enabled;
				menuBtnResume.enabled = runMenuItem.submenu.getItemByName( "resume" ).enabled;
				
				menuBtnStepInto.enabled = runMenuItem.submenu.getItemByName( "step_into" ).enabled;
				menuBtnStepOver.enabled = runMenuItem.submenu.getItemByName( "step_over" ).enabled;
				menuBtnStepReturn.enabled = runMenuItem.submenu.getItemByName( "step_return" ).enabled;
			}
		
			public function menuTemplateStateChangedHandler (event : MenuGeneralEvent) : void
			{
				if (!MenuManager.getInstance().menu)
					return;
				
				var templateMenuItem : NativeMenuItem = MenuManager.getInstance().menu.nativeMenu.getItemByName( MenuManager.MENU_TEMPLATE );
				
				menuAppSettings.enabled = menuBuild.enabled = templateMenuItem.enabled;
				
			}
			
			protected function creationCompleteHandler(event:FlexEvent):void
			{
				MenuManager.getInstance().addEventListener(MenuGeneralEvent.MENU_RUN_STATE_CHANGED, menuRunStateChangedHandler);
				MenuManager.getInstance().addEventListener(MenuGeneralEvent.MENU_TEMPLATE_STATE_CHANGED, menuTemplateStateChangedHandler);
			}
			
			private function get ctrlString () : String
			{
				return isMac ? String.fromCharCode(8984) : "Ctrl";
			}
			
			private function get altString () : String
			{
				return isMac ? String.fromCharCode(8997) : "Alt";
			}
			
			private function get separator () : String
			{
				return isMac ? "" : " + ";
			}
			
			private function get isMac () : Boolean
			{
				return FileUtils.OS == FileUtils.OS_MAC;;
			}
			
			private function get ctrlAndAltString () : String
			{
				return isMac ? altString + ctrlString : ctrlString + separator + altString;
			}
		]]>
	</mx:Script>
	
	<mx:Label text="Projects:" />
	
	<mx:ComboBox id="appsComboBox"
				 width="200"
				 dataProvider="{ContextManager.templates.getItemAt( 0 ).projects}" 
				 labelField="name"
				 selectedIndex="{ContextManager.templates.getItemAt( 0 ).selectedProjectIndex}"
				 change="cbApplicationsChangeHandler(event)"/>
	
	<control:ControlBarImage id="menuAppSettings" 
							 sourceEnabled="@Embed('assets/icons/settingsEnabled.png')" 
							 sourceDisabled="@Embed('assets/icons/settingsDisabled.png')"
							 toolTip="Template properties"
							 click="menuItem_clickHandler(event, ITEM_TYPE_APP_PROPERIES)"/>
	
	<mx:VRule height="20"/>
	
	<control:ControlBarImage id="menuBtnRun"
							 sourceEnabled="@Embed('assets/icons/runEnabled.png')"
							 sourceDisabled="@Embed('assets/icons/runDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_RUN)"
							 toolTip="Run ({ctrlString}{separator}R)"/>
	
	<control:ControlBarImage id="menuBtnDebug"
							 sourceEnabled="@Embed('assets/icons/debugEnabled.png')"
							 sourceDisabled="@Embed('assets/icons/debugDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_DEBUG)" 
							 toolTip="Debug ({ctrlString}{separator}D)"/>
	
	<control:ControlBarImage id="menuBtnStepByStep"
							 sourceEnabled="@Embed('assets/icons/stepByStepEnabled.png')"
							 sourceDisabled="@Embed('assets/icons/stepByStepDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_STEP_BY_STEP)" 
							 toolTip="Step by step ({ctrlAndAltString}{separator}D)"/>

	<mx:VRule height="20"/>
	
	<control:ControlBarImage id="menuBtnResume"
							 sourceEnabled="@Embed('assets/icons/ResumeEnabled.png')"
							 sourceDisabled="@Embed('assets/icons/ResumeDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_RESUME)" 
							 toolTip="Resume ({ctrlString}{separator}M)"/>
	
	<control:ControlBarImage id="menuBtnStepInto"
							 sourceEnabled="@Embed('assets/icons/StepIntoEnabled.png')"
							 sourceDisabled="@Embed('assets/icons/StepIntoDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_STEP_INTO)" 
							 toolTip="Step Into ({ctrlString}{separator}I)"/>
	
	<control:ControlBarImage id="menuBtnStepOver"
							 sourceEnabled="@Embed('assets/icons/StepOverEnabled.png')"
							 sourceDisabled="@Embed('assets/icons/StepOverDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_STEP_OVER)" 
							 toolTip="Step Over ({ctrlString}{separator}O)"/>

	<control:ControlBarImage id="menuBtnStepReturn"
							 sourceEnabled="@Embed('assets/icons/StepReturnEnabled.png')"
							 sourceDisabled="@Embed('assets/icons/StepReturnDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_STEP_RETURN)" 
							 toolTip="Step Return ({ctrlString}{separator}E)"/>
	
	<control:ControlBarImage id="menuBtnBreak"
							 sourceEnabled="@Embed('assets/icons/BreakEnabled.png')"
							 sourceDisabled="@Embed('assets/icons/BreakDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_BREAK)" 
							 toolTip="Break ({ctrlString}{separator}B)"/>
	
	<mx:VRule height="20"/>
	
	<control:ControlBarImage id="menuBuild"
							 sourceEnabled="@Embed('assets/icons/exportBuildEnabled.png')" 
							 sourceDisabled="@Embed('assets/icons/exportBuildDisabled.png')"
							 click="menuItem_clickHandler(event, ITEM_TYPE_BUILD_INSTALLER)" 
							 toolTip="Export project build (Adobe AIR or native file)"/>
	
	
</mx:ControlBar>
