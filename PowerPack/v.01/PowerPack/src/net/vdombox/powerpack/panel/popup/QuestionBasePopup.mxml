<?xml version="1.0" encoding="utf-8"?>
<popup:PopupBox xmlns:mx="http://www.adobe.com/2006/mxml" 
				xmlns:popup="net.vdombox.powerpack.panel.popup.*" 
				xmlns:control="net.vdombox.powerpack.control.*"
				creationComplete="completeHandler(event)">
	<mx:Script>
		<![CDATA[
			import mx.containers.Canvas;
			import mx.controls.Image;
			import mx.controls.Text;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			
			import net.vdombox.powerpack.control.PowerPackInstallerButton;
			
			[Bindable]
			private var question : String = "";
			
			public var strAnswer : String = "";
			
			private var dSize : Boolean = false;
			
			private var fCloseHandler : Function;
			
			public function setDefaultProperties(question : String, closeHandler : Function):void
			{
				this.question = question;
				fCloseHandler = closeHandler;
			}
			
			protected function btnOkClickHandler(evt:MouseEvent) : void
			{
				btnOk.removeEventListener(MouseEvent.CLICK, btnOkClickHandler);
				
				closeDialog();
			}
			
			protected function closeDialog() : void
			{
				if ( fCloseHandler != null )
				{
					addEventListener( CloseEvent.CLOSE, fCloseHandler );
					dispatchEvent( new CloseEvent( CloseEvent.CLOSE ) );
				}
				
				PopUpManager.removePopUp(this);
			}
			
			protected function completeHandler(event:FlexEvent):void
			{
				width = 400;
				//height = 300;
				PopUpManager.centerPopUp(this);
			}
			
			override protected function childrenCreated():void
			{
				super.childrenCreated();
			}
			
			override protected function measure():void
			{
				super.measure();
				
//				topPart.height = topH.height = Math.max(qText.height, qImg.height);
					
//				mainBox.height = bottomPart.height + topPart.height + 16//mainBox.getStyle("verticalGap");
			}
			
			override protected function updateDisplayList( unscaledWidth : Number, unscaledHeight : Number ) : void
			{
				trace ("qImage height: " + qText.height);
				trace ("top h = " + topPart.height);
				trace ("bottom h = " + bottomPart.height);
				
				trace ("answerCanvas h = " + answerCanvas.height);
				trace ("t1 h = " + t1.height);
				trace ("t2 h = " + t2.height);
				trace ("t3 h = " + t3.height);
				trace ("--------");
				
				super.updateDisplayList( unscaledWidth, unscaledHeight );
				
				
				
				//mainBox.height = bottomPart.height + topPart.height;;
				
				return;
				
				var dHeight : int = answerCanvas.maxVerticalScrollPosition;
				
				if ( !dSize && (dHeight) )
				{
					dSize = true;
					
					var container : DisplayObjectContainer = answerCanvas.parent;
					container.height += dHeight;
					while ( container != this)
					{
						container = container.parent;
						
						if ( dHeight )
							container.height += dHeight;
					}
					
					mainBox.height = bottomPart.y + bottomPart.height;
					mainBox.invalidateDisplayList();
					
					height = mainBox.height + 16;
					
					trace (" bottomPart height: " + bottomPart.y);
					trace (" bottomPart y: " + bottomPart.height);
					trace (" window height: " + height);
					trace ("------");
					
					super.updateDisplayList( unscaledWidth, unscaledHeight );
					
					//invalidateDisplayList();
					
					if (dHeight )
						callLater( PopUpManager.centerPopUp, [this] );
				}
			}
			
		]]>
	</mx:Script>
	
	<mx:VBox width="100%" id="mainBox">
		
		<mx:Canvas width="100%" id="topPart">
			<mx:HBox width="100%"
					 horizontalGap="10" id="topH">
				<mx:Image source="@Embed('/assets/images/question.png')" autoLoad="true" id="qImg"/>
				<mx:Text width="100%" height="100%"
						 paddingTop="5" paddingBottom="5"
						 styleName="infoTextStyle"
						 text="{question}"
						 selectable="false"
						 id="qText"/>
			</mx:HBox>
		</mx:Canvas>
		
		<popup:PopupBottomPart width="100%" id="bottomPart">
			<mx:VBox top="10" bottom="12" left="15" right="18" verticalGap="12" id="t1">
				<mx:HBox width="100%" height="100%" id="t2">
 					<mx:Image source="@Embed('/assets/images/user.png')" autoLoad="true" id="t3"/>
					<mx:Canvas width="100%" height="100%" id="answerCanvas">
					</mx:Canvas>
				</mx:HBox>
				<mx:Canvas width="100%">
					<control:PowerPackInstallerButton label="Ok" id="btnOk" 
							   							bottom="0" right="0"
														click="btnOkClickHandler(event)"/>
				</mx:Canvas>
			</mx:VBox>
		</popup:PopupBottomPart>
				
	</mx:VBox>
	
</popup:PopupBox>
